<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>PHONK SYSTEM PRO</title>
    <link rel="stylesheet" href="style.css">
    <link rel="manifest" href="manifest.json">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">

    <style>
        /* CSS G·ªêC GI·ªÆ NGUY√äN ƒê·ªÇ CH·∫†Y TR√äN TV/MOBILE */
        html, body {
            overflow-y: auto !important;
            height: auto !important;
            min-height: 100vh;
            background-color: #000;
            margin: 0;
            padding: 0;
            -ms-overflow-style: scrollbar !important;
        }

        .container {
            max-width: 500px;
            margin: 0 auto;
            padding: 15px;
            display: flex;
            flex-direction: column;
            min-height: 100vh; 
        }

        .playlist-container {
            flex: 1; 
            height: auto !important;
            max-height: none !important;
            overflow: visible !important;
            margin-bottom: 20px;
        }

        .controls {
            padding: 15px 0;
            background: rgba(0,0,0,0.8);
            border-top: 1px solid #333;
        }

        #status {
            text-align: center;
            margin-top: 10px;
            font-weight: bold;
            padding-bottom: 30px; 
        }

        .song-item:focus, .song-item.active {
            background: rgba(255, 0, 0, 0.2) !important;
            border-left: 5px solid red !important;
        }

        /* STYLE H·ªÜ TH·ªêNG T·∫¢I NH·∫†C AUTO */
        .btn-upload-top {
            position: fixed;
            top: 10px;
            left: 10px;
            z-index: 9999;
            padding: 8px 12px;
            background: #24292e;
            color: #ff0000;
            border: 1px solid #ff0000;
            border-radius: 5px;
            font-size: 11px;
            cursor: pointer;
            font-weight: bold;
        }

        .btn-yt-opener {
            width: 100%;
            padding: 15px;
            background: linear-gradient(45deg, #ff0000, #990000);
            color: white;
            border: none;
            border-radius: 10px;
            font-weight: bold;
            margin-bottom: 15px;
            cursor: pointer;
        }

        #yt-menu {
            display: none;
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 85%;
            max-width: 350px;
            background: #111;
            padding: 20px;
            border: 2px solid red;
            border-radius: 15px;
            z-index: 10000;
            text-align: center;
        }

        #yt-url {
            width: 100%;
            padding: 12px;
            margin: 15px 0;
            background: #222;
            border: 1px solid #444;
            color: white;
            border-radius: 5px;
            box-sizing: border-box;
        }

        #dl-progress {
            display: none;
            color: #00ff00;
            font-size: 13px;
            margin: 10px 0;
        }
    </style>
</head>
<body>
    <button class="btn-upload-top" onclick="window.open('https://github.com/phucnguyen987/Phonk-web/upload/main/music', '_blank')">üìÇ UPLOAD FILE</button>

    <div id="intro-page">
        <div class="intro-content">
            <h1 class="glitch">‚ò£Ô∏è PHUCNGUYEN X PHONK ‚ò£Ô∏è</h1>
            <p>H∆†N 50 B√ÄI HAY NH·∫§T 2026 | HO·∫†T ƒê·ªòNG 24/7</p>
            <button class="start-btn" onclick="startAppFixed()">V√ÄO H·ªÜ TH·ªêNG</button>
        </div>
    </div>

    <div class="container">
        <h2 class="neon-text">üéµPHONK MUSICüéµ</h2>
        
        <button class="btn-yt-opener" onclick="document.getElementById('yt-menu').style.display='block'">üì• AUTO DOWNLOAD MP3 (YT)</button>

        <input type="text" id="searchInput" placeholder="T√¨m t√™n b√†i Phonk..." onkeyup="filterSongs()">

        <div id="customPlaylist" class="playlist-container"></div>

        <div class="controls">
            <div style="display: flex; gap: 10px; margin-bottom: 10px;">
                <button class="btn-main" style="flex: 2;" onclick="handlePlay()" id="playBtn">PH√ÅT NH·∫†C</button>
                <button class="btn-loop" style="flex: 1;" onclick="handleLoop()" id="loopBtn">L·∫∂P: T·∫ÆT</button>
            </div>
            <div id="status">‚úÖ ƒê√£ s·∫µn s√†ng: 7 b√†i!</div>
        </div>
    </div>

    <div id="yt-menu">
        <h3 style="margin:0; color:red;">D√ÅN LINK YOUTUBE</h3>
        <input type="text" id="yt-url" placeholder="https://www.youtube.com/watch?v=...">
        
        <button id="dl-btn" onclick="autoDownload()" style="width:100%; padding:12px; background:#fff; color:#000; border:none; border-radius:5px; font-weight:bold;">
            T·∫¢I XU·ªêNG NGAY
        </button>

        <div id="dl-progress">‚è≥ ƒêang x·ª≠ l√Ω... Vui l√≤ng ƒë·ª£i!</div>

        <button onclick="document.getElementById('yt-menu').style.display='none'" style="margin-top:15px; background:none; border:none; color:gray;">ƒê√≥ng</button>
    </div>

    <audio id="mainAudio" playsinline></audio>
    <script src="script.js"></script>

    <script>
        function startAppFixed() {
            document.getElementById('intro-page').style.display = 'none';
            if (typeof startApp === "function") startApp();
            setTimeout(() => { window.scrollTo(0, 0); }, 300);
        }

        window.addEventListener("keydown", function(e) {
            if (e.keyCode === 40) { window.scrollBy({ top: 200, behavior: 'smooth' }); }
            else if (e.keyCode === 38) { window.scrollBy({ top: -200, behavior: 'smooth' }); }
        });

        // LOGIC T·∫¢I AUTO KH√îNG QUA WEB TRUNG GIAN
        function autoDownload() {
            const url = document.getElementById('yt-url').value;
            const btn = document.getElementById('dl-btn');
            const progress = document.getElementById('dl-progress');

            if (!url.includes("youtube.com") && !url.includes("youtu.be")) {
                alert("Link kh√¥ng h·ª£p l·ªá!");
                return;
            }

            btn.style.display = 'none';
            progress.style.display = 'block';

            let videoId = "";
            try {
                if(url.includes("v=")) { videoId = url.split("v=")[1].split("&")[0]; }
                else { videoId = url.split("/").pop(); }
            } catch(e) { alert("L·ªói l·∫•y ID video!"); return; }

            // S·ª≠ d·ª•ng API Endpoint tr·ª±c ti·∫øp ƒë·ªÉ k√≠ch ho·∫°t Download
            const apiUrl = `https://api.vevioz.com/api/button/mp3/${videoId}`;
            
            // T·∫°o m·ªôt th·∫ª 'a' ·∫©n ƒë·ªÉ th·ª±c hi·ªán l·ªánh t·∫£i ng·∫ßm
            const downloadAnchor = document.createElement('a');
            downloadAnchor.style.display = 'none';
            downloadAnchor.href = apiUrl;
            downloadAnchor.setAttribute('download', ''); // √âp tr√¨nh duy·ªát t·∫£i v·ªÅ
            downloadAnchor.target = '_self'; // Gi·ªØ nguy√™n ·ªü trang hi·ªán t·∫°i
            
            document.body.appendChild(downloadAnchor);
            downloadAnchor.click(); // K√≠ch ho·∫°t l·ªánh t·∫£i

            // Th√¥ng b√°o tr·∫°ng th√°i
            setTimeout(() => {
                progress.innerHTML = "‚úÖ ƒê√£ g·ª≠i l·ªánh t·∫£i! Ki·ªÉm tra m√°y b·∫°n.";
                setTimeout(() => {
                    progress.style.display = 'none';
                    btn.style.display = 'block';
                    document.getElementById('yt-menu').style.display = 'none';
                    document.getElementById('yt-url').value = "";
                }, 3000);
            }, 2000);
        }
    </script>
</body>
</html>
